---
title: http状态管理方案
categories:
  - 后端
date: 2018-03-14 20:44:45
tags:
  - 网络
---

[原文地址](http://mp.weixin.qq.com/s/R9UMjxJs8zZVnPO1DaUpuA)

### 一、http的无状态性

http是无状态协议。他不对之前发送的请求和响应进行管理。也就是说，无法根据之前的状态对本次的请求进行处理。教授要求进行登录认证的web应用无法对状态进行管理。那么每次跳转新页面不是再次进行登录就是要在报文中对登录状态进行管理。

### 二、Cookie 技术的引入

如果让服务端全部保存客户端的状态，那么就会成为服务端的负担。保留无状态协议的特征，同时要解决类似的问题，于是引入了cookie技术。cookie是通过在请求和响应的报文中添加cookie信息而控制客户端的登录状态。

### 三、基于表单的认证

目前的用户认证多是基于表单的认证。基于表单的认证，一般都会使用cookie来管理session。基于表单的认证本身是通过服务器的wap应用，将客户端发送过来的用户id和密码，与之前登陆过的信息做匹配来进行认证的。

但是鉴于http是无状态协议，之前已认证的用户状态，无法通过协议层保存下来，既无法实现状态管理，因此即使登用户在继续访问，也无法区分与其他的用户，于是我们会使用cookie来管理session，以弥补http协议中不存在的状态管理功能。

### 四、Session存储位置及集群情况下的问题

Session是存储在Web服务器（例如Tomcat）中的，并针对每个客户端（客户），通过SessionID来区别不同的用户的。Session是以Cookie技术或URL重写来实现，默认以Cookie技术实现，服务端会给这次回话创造一个JSESSIONID的Cookie值。

但是存在一个显著问题就是，在集群模式下如果通过Nginx负载均衡的时候，如果有一个用户登录的时候请求被分配到服务器A上，登录成功后设置的Session就会被存储在A服务器上，但是在服务器B上就没有该用户的Session数据，当用户再一次发起一个请求的时候，此时请求如果被分配到服务器B上，则就不会查询到该用户的登录状态，就会出现登录失败的情况。

*   一种解决思路是将多个Web服务器上存储的Session统一存储到某一个存储介质中，保证进集群中的每一台机器都可以看到所有相同的Session数据。这里的同步体现在所有的Session存储在同一存储介质中。
    
*   tomcat容器为我们提供了一个接口，可以让我们实现将Session存储到除了当前服务器之外的其他存储介质上，例如Redies。
    
*   spring session的本质就是通过实现tomcat提供的的接口将session存储到Redis中，已实现Session的同一存储管理。
    

### 五、小结与需求痛点

Session和Cookie的目的相同，都是为了解决Http协议的无状态的缺陷，但是完成方法不同，Session是通过Cookie 将SessionID保存的客户端。二将其他的回话消息保存在服务端的Session对象中，于此相对的Cookie则是将所有的用户信息保存在Cookie即客户端，因此这种方式存在一定的安全隐患。但是Session在面对集群问题是的解决方案又略显复杂。因此有没有一种小而轻便的方式来解决我们这种认证需求呢？**那就是JWT了！**
---
title: DNS域名解析
categories:
  - 后端
date: 2018-02-24 14:43:52
tags:
  - 网络
---

我们都知道互联网都是通过URL来发布和请求资源的，而URL中的域名是需要解析成IP地址才能与远程主机建立连接，如何将域名解析成IP地址就属于DNS的工作范畴。

可以毫不夸张的说，虽然我们平时上网感觉不到DNS解析的存在，但是一旦DNS解析出错，可能会导致严重的互联网灾难。目前世界上的整个互联网有几个DNS根域名服务器，任何一台服务器坏掉，后果都会非常严重。

DNS域名解析过程
---------

当用户在浏览器中输入 www.abc.com时，DNS解析将会有将近10个步骤，这个过程答题描述如下：

1.  浏览器会检查缓存中有没有对应的解析过的IP地址。
2.  如果用户浏览器缓存中没有，浏览器会查找操作系统缓存中是否有这个域名对应的DNS解析结果。
3.  如果操作系统中没有，操作系统会把这个域名发送给系统里设置的LDNS，也就是本地区的域名服务器。
4.  如果LDNS没有命中，就直接到 Root Server 域名服务器请求解析。
5.  根域名服务器会返回给贝蒂域名服务器一个所查询域的主域名服务器（gTLD Server）地址，gTLD是国际顶级域名服务器，如.com、.cn、.org等，全球只有13台左右。
6.  本地域名服务器（Local DNS Server）在向上一步返回的gTLD服务器发送请求。
7.  接受请求的gTLD服务器查找并返回此域名对应的Name Server域名服务器地址，这个Name Server通常就是你注册的域名服务器，例如你在某个服务器提供上申请的域名，那么这个域名解析任务就由这个域名提供商的服务器来完成。
8.  Name Server 域名服务器会查询存储的域名和IP的映射关系表，连同一个TTL值返回给DNS Server域名服务器。
9.  返回该域名对应的IP和TTL值，Local NDS Server 会缓存这个域名和ip的对应关系，缓存的时间由TTL值控制。
10.  把解析的结果返回给用户，用户根据TTL值缓存在本地系统缓存中，域名解析过程结束。

在实际DNS解析过程中，可能还不止10个步骤，如Name Server 也可能有多级，或者有一个GTM来负责负载均衡，这都可能会影响域名解析的过程。

域名解析类型
------

域名解析记录主要分为 A 记录、MX记录、CNAME记录、NS记录和TXT记录。

*   A 记录， A代表的是address，用来指定域名对应的IP地址，如将 item.taobao.com 指定到 115.112.111.22，A记录可以将多个域名解析到一个IP上，但是不能将一个域名解析到多个IP上。
*   MX 记录，表示的是Mail Exchange，即时可以将某个域名下的邮件服务器指向自己的MailServer。发邮件时DNS会将邮件发送到MX记录对应的地址，而正常通过Web请求的话仍然解析到A记录的IP地址。
*   CNAME 记录，全称是Canonical Name（别名解析）。所谓别名解析就是可以为一个域名设置一个或多个别名。如将a.com 解析到 b.com。
*   NS 记录，为某个域名指定DNS解析服务器，也就是这个域名有指定的IP地址的DNS服务器去解析。
*   TXT记录，为某个主机名或域名设置说明，如可以为 a.net设置TXT记录为“GMX的博客”这样的说明。